

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>API Reference &mdash; LAPA-NG  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Usage" href="usage.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            LAPA-NG
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#core-components">Core Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#translator">Translator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#matcher">Matcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementations">Implementations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-types">Data Types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rule-systems">Rule Systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#table-rules">Table Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#regex-rules">Regex Rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#factory-pattern">Factory Pattern</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#matcher-specification">Matcher Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="#factory-functions">Factory Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create_matcher"><code class="docutils literal notranslate"><span class="pre">create_matcher()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#parse_matcher_spec"><code class="docutils literal notranslate"><span class="pre">parse_matcher_spec()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#MatcherSpec"><code class="docutils literal notranslate"><span class="pre">MatcherSpec</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#command-line-interface">Command-Line Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#converting-rules">Converting Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transcribing-text">Transcribing Text</a></li>
<li class="toctree-l3"><a class="reference internal" href="#processing-naf-files">Processing NAF Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#usage-example">Usage Example</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">LAPA-NG</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">API Reference</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="api-reference">
<h1>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading"></a></h1>
<p>This page provides detailed documentation for the LAPA-NG Python API, a system for phonetic transcription of Dutch text using rule-based pattern matching.</p>
<section id="core-components">
<h2>Core Components<a class="headerlink" href="#core-components" title="Link to this heading"></a></h2>
<p>The LAPA-NG system is built around several core components that work together to perform phonetic transcription:</p>
<section id="translator">
<h3>Translator<a class="headerlink" href="#translator" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Translator</span></code> protocol defines the interface for translating words into phonemes. It provides a single method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="n">WordOrWordList</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">emit</span><span class="p">:</span> <span class="n">EmitValue</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">TranslationResult</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</pre></div>
</div>
<p>The translator can process either a single word or a list of words, and can emit results at different granularities (word, rule, or phoneme level).</p>
</section>
<section id="matcher">
<h3>Matcher<a class="headerlink" href="#matcher" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Matcher</span></code> protocol defines how to match substrings of words against rules and return corresponding phonetic transcriptions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">:</span> <span class="n">Word</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">MatchResult</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="implementations">
<h3>Implementations<a class="headerlink" href="#implementations" title="Link to this heading"></a></h3>
<p>The system provides several concrete implementations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MatchingTranslator</span></code>: A translator that uses a matcher to translate words into phonemes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CachedTranslator</span></code>: A translator wrapper that caches results to improve performance</p></li>
</ul>
</section>
<section id="data-types">
<h3>Data Types<a class="headerlink" href="#data-types" title="Link to this heading"></a></h3>
<p>The system uses several key data types:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Word</span></code>: Represents a single word with optional attributes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Phoneme</span></code>: Represents a single phoneme with various representations (SAMPA, IPA)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MatchResult</span></code>: Contains the result of a successful rule match</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TranslationResult</span></code>: Contains the final translation result for a word</p></li>
</ul>
</section>
</section>
<section id="rule-systems">
<h2>Rule Systems<a class="headerlink" href="#rule-systems" title="Link to this heading"></a></h2>
<p>LAPA-NG supports two complementary rule systems for phonetic transcription:</p>
<section id="table-rules">
<h3>Table Rules<a class="headerlink" href="#table-rules" title="Link to this heading"></a></h3>
<p>The table rules system provides a user-friendly way to define phonetic transcription rules using tabular data (e.g., Excel spreadsheets). This system is designed to be more accessible to linguists and phoneticians who may not be familiar with regular expressions.</p>
<p>Key Components:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TabularRule</span></code>: Represents a single rule from a tabular data source
- <code class="docutils literal notranslate"><span class="pre">rule_id</span></code>: Unique identifier for the rule
- <code class="docutils literal notranslate"><span class="pre">rule_class</span></code>: Type of rule (VOWEL, CONSONANT, or PREFIX)
- <code class="docutils literal notranslate"><span class="pre">letter</span></code>: Initial letter that the rule applies to
- <code class="docutils literal notranslate"><span class="pre">priority</span></code>: Priority value for rule ordering
- <code class="docutils literal notranslate"><span class="pre">description</span></code>: Human-readable description of the rule
- <code class="docutils literal notranslate"><span class="pre">rule</span></code>: The rule pattern or definition
- <code class="docutils literal notranslate"><span class="pre">replaced</span></code>: Letter sequence to be replaced
- <code class="docutils literal notranslate"><span class="pre">replaceby</span></code>: Replacement letter sequence</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RuleClass</span></code>: Enumeration of rule types
- <code class="docutils literal notranslate"><span class="pre">VOWEL</span></code>: Rules for vowel sounds
- <code class="docutils literal notranslate"><span class="pre">CONSONANT</span></code>: Rules for consonant sounds
- <code class="docutils literal notranslate"><span class="pre">PREFIX</span></code>: Rules for prefix patterns</p></li>
</ul>
<p>The table rules system provides utilities for:
- Loading rules from tabular data sources
- Converting tabular rules to regex specifications
- Sorting rules by priority
- Checking for duplicate priorities
- Creating matchers from tabular rules</p>
</section>
<section id="regex-rules">
<h3>Regex Rules<a class="headerlink" href="#regex-rules" title="Link to this heading"></a></h3>
<p>The regex rules system provides a more powerful and flexible way to define phonetic transcription rules using regular expressions. This system is used internally to implement the actual matching logic.</p>
<p>Key Components:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RegexRuleSpec</span></code>: Specification for a regular expression based rule
- <code class="docutils literal notranslate"><span class="pre">id</span></code>: Unique identifier for the rule
- <code class="docutils literal notranslate"><span class="pre">pattern</span></code>: Compiled regular expression pattern
- <code class="docutils literal notranslate"><span class="pre">replacement</span></code>: Phonetic replacement string
- <code class="docutils literal notranslate"><span class="pre">meta</span></code>: Additional metadata about the rule</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RegexMatcher</span></code>: A matcher that uses regular expressions for pattern matching
- Optimized for prefix rules and match group extraction
- Supports character classes for common patterns
- Includes caching for improved performance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RegexListMatcher</span></code>: An optimized list matcher for regex-based rules
- Uses caching and filtering based on the first letter
- Reduces the number of rules that need to be attempted
- Maintains rule ordering and priority</p></li>
</ul>
<p>The regex rules system provides functions for:
- Loading rule specifications from YAML files
- Creating matchers from rule specifications
- Optimizing rule matching performance</p>
</section>
</section>
<section id="factory-pattern">
<h2>Factory Pattern<a class="headerlink" href="#factory-pattern" title="Link to this heading"></a></h2>
<p>LAPA-NG uses a factory pattern to create different types of matchers based on a specification string. This provides a flexible and consistent way to create matchers for different use cases.</p>
<section id="matcher-specification">
<h3>Matcher Specification<a class="headerlink" href="#matcher-specification" title="Link to this heading"></a></h3>
<p>The matcher specification follows the format:</p>
<blockquote>
<div><p>[prefix:][filename[#sheet]][?options]</p>
</div></blockquote>
<p>Where:
- <code class="docutils literal notranslate"><span class="pre">prefix</span></code>: Optional prefix indicating the type of matcher (‘ng’ or ‘classic’)
- <code class="docutils literal notranslate"><span class="pre">filename</span></code>: Path to the rules file (Excel or YAML)
- <code class="docutils literal notranslate"><span class="pre">sheet</span></code>: Optional sheet name for Excel files
- <code class="docutils literal notranslate"><span class="pre">options</span></code>: Optional query string parameters (e.g., ?sort=numeric)</p>
<p>Available options for the ‘ng’ prefix:
- <code class="docutils literal notranslate"><span class="pre">sort</span></code>: Rule sorting method (‘numeric’ or ‘alpha’)</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">numeric</span></code>: Sort rules by numeric priority (default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code>: Sort rules alphabetically by letter and priority</p></li>
</ul>
</div></blockquote>
<p>Examples:
.. code-block:: python</p>
<blockquote>
<div><p># Next-gen matcher with specific sheet and numeric sorting (default)
matcher = create_matcher(‘ng:rules.xlsx#RULES’)</p>
<p># Next-gen matcher with alpha sorting
matcher = create_matcher(‘ng:rules.xlsx#RULES?sort=alpha’)</p>
<p># Classic matcher, default sheet
matcher = create_matcher(‘classic:rules.xlsx’)</p>
<p># Next-gen matcher (default prefix)
matcher = create_matcher(‘rules.xlsx#RULES’)</p>
</div></blockquote>
</section>
<section id="factory-functions">
<h3>Factory Functions<a class="headerlink" href="#factory-functions" title="Link to this heading"></a></h3>
<p>The factory module provides the following functions:</p>
<dl class="py function">
<dt class="sig sig-object py" id="create_matcher">
<span class="sig-name descname"><span class="pre">create_matcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matcher_spec</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Matcher</span></span></span><a class="headerlink" href="#create_matcher" title="Link to this definition"></a></dt>
<dd><p>Create a matcher based on a specification string.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>matcher_spec: Specification string in format ‘[prefix:][filename[#sheet]][?options]’</p>
</dd>
<dt>Returns:</dt><dd><p>A Matcher instance configured according to the specification</p>
</dd>
<dt>Raises:</dt><dd><dl class="simple">
<dt>ValueError: If the prefix is unknown, the specification is invalid,</dt><dd><p>or an invalid sort option is provided</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="parse_matcher_spec">
<span class="sig-name descname"><span class="pre">parse_matcher_spec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matcher_spec</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#MatcherSpec" title="MatcherSpec"><span class="pre">MatcherSpec</span></a></span></span><a class="headerlink" href="#parse_matcher_spec" title="Link to this definition"></a></dt>
<dd><p>Parse a matcher specification string into its components.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>matcher_spec: The specification string to parse</p>
</dd>
<dt>Returns:</dt><dd><p>A MatcherSpec object containing the parsed components</p>
</dd>
<dt>Raises:</dt><dd><p>ValueError: If the specification string is invalid</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="MatcherSpec">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">MatcherSpec</span></span><a class="headerlink" href="#MatcherSpec" title="Link to this definition"></a></dt>
<dd><p>A dataclass representing a parsed matcher specification.</p>
<dl class="simple">
<dt>Attributes:</dt><dd><p>prefix: The matcher prefix (‘ng’ or ‘classic’)
filename: Path to the rules file
section: Optional sheet name
options: Optional query string parameters</p>
</dd>
<dt>Properties:</dt><dd><p>qs: Dictionary of parsed query string parameters
qs_flat: Simplified dictionary with single values for each parameter</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="command-line-interface">
<h2>Command-Line Interface<a class="headerlink" href="#command-line-interface" title="Link to this heading"></a></h2>
<p>LAPA-NG provides a command-line interface for common operations:</p>
<section id="converting-rules">
<h3>Converting Rules<a class="headerlink" href="#converting-rules" title="Link to this heading"></a></h3>
<p>Convert Excel-based rules to YAML format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lapa-ng<span class="w"> </span>convert-excel<span class="w"> </span>rules.xlsx<span class="w"> </span>rules.yaml
<span class="c1"># Optional: specify a particular sheet</span>
lapa-ng<span class="w"> </span>convert-excel<span class="w"> </span>rules.xlsx<span class="w"> </span>rules.yaml<span class="w"> </span>--sheet<span class="w"> </span><span class="s2">&quot;RULES&quot;</span>
</pre></div>
</div>
<p>This command reads rules from an Excel file and converts them to YAML format,
which can be used directly with the regex rules system.</p>
</section>
<section id="transcribing-text">
<h3>Transcribing Text<a class="headerlink" href="#transcribing-text" title="Link to this heading"></a></h3>
<p>Transcribe words from the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lapa-ng<span class="w"> </span>translate-words<span class="w"> </span><span class="s1">&#39;rules.xlsx#RULES&#39;</span><span class="w"> </span>word1<span class="w"> </span>word2<span class="w"> </span>word3
</pre></div>
</div>
<p>This command transcribes one or more words using the specified rules and outputs
the phonetic transcription in SAMPA format.</p>
</section>
<section id="processing-naf-files">
<h3>Processing NAF Files<a class="headerlink" href="#processing-naf-files" title="Link to this heading"></a></h3>
<p>Process text from NAF (NLP Annotation Framework) files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lapa-ng<span class="w"> </span>translate-naf<span class="w"> </span><span class="s1">&#39;rules.xlsx#RULES&#39;</span><span class="w"> </span>input.naf
</pre></div>
</div>
<p>This command reads text from a NAF file, transcribes it using the specified rules,
and outputs the results in CSV format with detailed information about each
transcription, including:
- Word ID and text
- Position in the word
- Matched pattern
- Phoneme in SAMPA format
- Rule ID used
- Number of rules attempted</p>
</section>
<section id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Link to this heading"></a></h3>
<p>Run the test suite:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lapa-ng<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>This command runs the test suite to verify the system is working correctly.</p>
</section>
</section>
<section id="usage-example">
<h2>Usage Example<a class="headerlink" href="#usage-example" title="Link to this heading"></a></h2>
<p>Here’s a complete example of how the components work together:</p>
<ol class="arabic">
<li><p>Define rules in an Excel spreadsheet with columns for:
- Rule ID
- Rule class (VOWEL, CONSONANT, PREFIX)
- Letter
- Priority
- Description
- Rule pattern
- Replacement pattern</p></li>
<li><p>Convert the rules to YAML format:
.. code-block:: bash</p>
<blockquote>
<div><p>lapa-ng convert-excel rules.xlsx rules.yaml</p>
</div></blockquote>
</li>
<li><p>Use the rules to transcribe text:
.. code-block:: bash</p>
<blockquote>
<div><p>lapa-ng translate-words ‘rules.xlsx#RULES’ “voorbeeld” “taal”
# Output: v r o n d &#64; r b &#64; l t a l</p>
</div></blockquote>
</li>
<li><p>Process a NAF file:
.. code-block:: bash</p>
<blockquote>
<div><p>lapa-ng translate-naf ‘rules.xlsx#RULES’ document.naf &gt; transcriptions.csv</p>
</div></blockquote>
</li>
</ol>
<p>The system will:
1. Load and validate the rules
2. Convert them to an optimized regex-based format
3. Process the input text
4. Apply the rules in the correct order
5. Output the phonetic transcriptions</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="usage.html" class="btn btn-neutral float-left" title="Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, LAPA-NG Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>